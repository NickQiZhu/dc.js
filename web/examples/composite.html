<!DOCTYPE html>
<html lang="en">
<head>
    <title>dc.js - Composite Chart Example</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../css/dc.css"/>
</head>
<body>

<div id="test_composed"></div>

<script type="text/javascript" src="../js/d3.js"></script>
<script type="text/javascript" src="../js/crossfilter.js"></script>
<script type="text/javascript" src="../js/dc.js"></script>
<script type="text/javascript">

    var chart1 = dc.lineChart();
    var chart2 = dc.lineChart();

    var chartsLoaded = 0;

    function chartLoaded() {
        chartsLoaded++;
        if (chartsLoaded < 2) return;

        var composite = dc.compositeChart("#test_composed");
        composite
                .width(768)
                .height(480)
                .x(d3.scale.linear().domain([0,20]))
                .yAxisLabel("The Y Axis")
                .legend(dc.legend().x(80).y(20).itemHeight(13).gap(5))
                .compose([chart1, chart2])
                .render();
    }

    d3.csv("morley.csv", function(error, experiments) {
        experiments.forEach(function(x) {
            x.Speed = +x.Speed;
        });

        var ndx                 = crossfilter(experiments),
            runDimension        = ndx.dimension(function(d) {return +d.Run;})
        speedSumGroup       = runDimension.group().reduceSum(function(d) {return d.Speed * d.Run / 1000;});
        chart1
                .dimension(runDimension)
                .colors(['red'])
                .group(speedSumGroup, "Top Line")
                .dashStyle([2,2]);

        chartLoaded();
    });

    d3.csv("morley2.csv", function(error, experiments) {
        experiments.forEach(function(x) {
            x.Speed = +x.Speed;
        });

        var ndx                 = crossfilter(experiments),
                runDimension        = ndx.dimension(function(d) {return +d.Run;})
        speedSumGroup       = runDimension.group().reduceSum(function(d) {return d.Speed * d.Run / 1000;});

        chart2
                .dimension(runDimension)
                .colors(['blue'])
                .group(speedSumGroup, "Bottom Line")
                .dashStyle([5,5]);

        chartLoaded();
    });
</script>

</body>
</html>
